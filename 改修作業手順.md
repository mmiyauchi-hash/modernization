# 既存デプロイ物の改修作業手順

このドキュメントでは、既にVercelにデプロイしている開発物を改修する際の具体的な手順を説明します。

## 🎯 クイックスタート（改修作業の流れ）

```
1. 開発環境の準備
   ↓
2. コードの修正
   ↓
3. ローカルで動作確認
   ↓
4. ビルドテスト
   ↓
5. Gitにコミット・プッシュ
   ↓
6. Vercelで自動デプロイ確認
```

---

## 📋 詳細手順

### ステップ1: 開発環境の準備

#### 1-1. プロジェクトフォルダに移動

```bash
cd "/Users/minorumiyauchi/Desktop/AI駆動エンジン商談/IGPF/devops-modernization-agent-vite"
```

#### 1-2. 依存パッケージの確認・インストール

```bash
# 依存パッケージが最新か確認（必要に応じて）
npm install
```

#### 1-3. 現在のGitの状態を確認

```bash
# 現在のブランチと変更状況を確認
git status

# リモートとの差分を確認（必要に応じて）
git fetch
git status
```

---

### ステップ2: コードの修正

#### 2-1. エディタ（Cursor）でコードを編集

主な編集箇所：
- **`src/components/`** - Reactコンポーネント（UI部品）
- **`src/lib/`** - ビジネスロジック（シナリオ定義など）
- **`src/store/`** - 状態管理（Zustand）
- **`src/types/`** - TypeScript型定義
- **`src/pages/`** - ページコンポーネント

#### 2-2. 開発サーバーを起動（別ターミナル）

```bash
npm run dev
```

ブラウザで `http://localhost:5173` が開きます。ここで変更をリアルタイムで確認しながら開発できます。

**ヒント：** エディタで保存すると、ブラウザが自動的に更新されます（Hot Module Replacement）。

---

### ステップ3: ローカルで動作確認

#### 3-1. 機能の動作確認

- ブラウザで実際に操作して、期待通りに動作するか確認
- エラーメッセージが表示されていないか確認
- ターミナルにエラーが出力されていないか確認

#### 3-2. TypeScriptの型チェック（エディタ内で自動確認）

Cursorなどのエディタでは、保存時に自動的に型チェックが行われます。

---

### ステップ4: ビルドテスト（重要！）

本番環境と同じ状態でビルドして、エラーがないか確認します。

```bash
npm run build
```

**成功した場合：**
```
✓ built in Xs
```

`dist/` フォルダにビルド成果物が生成されます。

**エラーが出た場合：**
- エラーメッセージを確認して修正
- 修正後、再度 `npm run build` を実行
- エラーが解消されるまで繰り返す

---

### ステップ5: Gitにコミット・プッシュ

#### 5-1. 変更内容を確認

```bash
git status
```

変更されたファイルの一覧が表示されます。

#### 5-2. 変更ファイルをステージング（追加）

```bash
# すべての変更を追加する場合
git add .

# 特定のファイルだけ追加する場合（例）
git add src/components/ChatArea.tsx
```

#### 5-3. コミット（変更内容を記録）

```bash
git commit -m "コミットメッセージを記入"
```

**コミットメッセージの例：**
- `"fix: チャット画面のレイアウトを修正"`
- `"feat: メニュー管理機能に検索機能を追加"`
- `"update: エラーメッセージの文言を改善"`
- `"refactor: AdminPanelコンポーネントを整理"`

**メッセージのプレフィックス：**
- `fix:` - バグ修正
- `feat:` - 新機能追加
- `update:` - 機能改善・更新
- `refactor:` - コードの整理・リファクタリング
- `docs:` - ドキュメントの更新

#### 5-4. GitHubへプッシュ

```bash
git push
```

**初回または認証エラーの場合：**
- GitHubのユーザー名を入力
- Personal Access Token（パスワードの代わり）を入力

**プッシュが成功すると：**
```
Enumerating objects: X, done.
Counting objects: 100% (X/X), done.
To https://github.com/mmiyauchi-hash/modernization.git
   abc1234..def5678  main -> main
```

---

### ステップ6: Vercelで自動デプロイ確認

#### 6-1. Vercelダッシュボードを確認

1. **[Vercelダッシュボード](https://vercel.com/dashboard)にアクセス**
2. **プロジェクト（`modernization`）を選択**
3. **「Deployments」タブを確認**

#### 6-2. デプロイの状態を確認

- **`Building`** - ビルド中（通常1-3分）
- **`Ready`** - デプロイ完了
- **`Error`** - エラー発生（詳細を確認）

#### 6-3. デプロイ完了の確認

1. **ステータスが「Ready」になったら完了**
2. **「Visit」ボタンをクリック**または、公開URLにアクセス
   - URL: [https://modernization-kappa.vercel.app/](https://modernization-kappa.vercel.app/)
3. **実際のサイトで動作確認**

#### 6-4. エラーが発生した場合

1. **Vercelの「Deployments」画面で該当デプロイをクリック**
2. **「Build Logs」タブでエラー内容を確認**
3. **ローカルで `npm run build` を実行して同じエラーが再現するか確認**
4. **エラーを修正して、再度 `git commit` → `git push`**

---

## ⚠️ 注意事項

### コミット・プッシュ前に必ず確認すること

1. ✅ **ローカルで `npm run dev` が正常に動作すること**
2. ✅ **`npm run build` でエラーが出ないこと**
3. ✅ **型エラーがないこと**
4. ✅ **不要なファイル（`.env.local`、`node_modules`など）をコミットしていないこと**

### 変更が反映されない場合

1. **ブラウザのキャッシュをクリア**
   - Mac: `Cmd + Shift + R`
   - Windows: `Ctrl + Shift + R`
2. **Vercelのデプロイが完了しているか確認**
3. **GitHubに正しくプッシュできているか確認**

---

## 🔧 よくあるトラブル

### トラブル1: `git push` で認証エラー

**症状：**
```
remote: Invalid username or token
fatal: Authentication failed
```

**対処法：**
1. GitHubのPersonal Access Tokenを再生成
2. トークンの取得方法：[GitHub公式ドキュメント](https://docs.github.com/ja/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens)

### トラブル2: ビルドエラー

**症状：**
```
error TS6133: 'Save' is declared but its value is never read.
```

**対処法：**
- 未使用の変数やインポートを削除
- または、一時的にコメントアウトして後で対応

### トラブル3: Vercelでデプロイが失敗

**対処法：**
1. Vercelの「Build Logs」でエラー内容を確認
2. ローカルで `npm run build` を実行して同じエラーが出るか確認
3. エラーを修正して再度 `git push`

### トラブル4: 変更が反映されない

**確認ポイント：**
1. GitHubにプッシュできているか（[リポジトリ](https://github.com/mmiyauchi-hash/modernization)で確認）
2. Vercelのデプロイが完了しているか（「Ready」状態か）
3. ブラウザのキャッシュをクリア

---

## 📝 開発のベストプラクティス

### 1. 小さな変更を頻繁にコミット

大きな変更を一度にまとめるのではなく、機能単位で小さくコミットすることを推奨します。

### 2. 明確なコミットメッセージ

何を変更したのか、なぜ変更したのかが分かるメッセージにしましょう。

### 3. ビルドテストを習慣化

コミット・プッシュ前に必ず `npm run build` を実行してエラーがないか確認しましょう。

### 4. ブランチ戦略（将来的に）

現在は`main`ブランチに直接プッシュしていますが、将来的には以下のようなブランチ戦略を検討できます：

- `main` - 本番環境（直接プッシュ）
- `develop` - 開発環境（機能開発用）
- `feature/xxx` - 機能開発用ブランチ

---

## 🔗 参考リンク

- **GitHubリポジトリ**: [https://github.com/mmiyauchi-hash/modernization](https://github.com/mmiyauchi-hash/modernization)
- **Vercelダッシュボード**: [https://vercel.com/dashboard](https://vercel.com/dashboard)
- **公開URL**: [https://modernization-kappa.vercel.app/](https://modernization-kappa.vercel.app/)
- **詳細な開発ガイド**: `DEVELOPMENT_GUIDE.md` を参照

---

**最終更新日**: 2026年1月14日
